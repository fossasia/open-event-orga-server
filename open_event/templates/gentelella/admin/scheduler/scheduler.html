{% extends 'gentelella/admin/base.html' %}
{% block head_css %}
    {{ super() }}
    <link href="{{ url_for('static', filename='css/admin/scheduler.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='admin/lib/bootstrap-daterangepicker/daterangepicker.css') }}"
          rel="stylesheet">
{% endblock %}

{% block body %}
    <div class="" role="tabpanel">
        <ul id="myTab" class="nav nav-tabs " role="tablist">
            <li role="presentation"><a href="/admin/events/{{ event.id }}/">Home</a></li>
            <li role="presentation" class="active"><a href="/admin/events/{{ event.id }}/scheduler/">Scheduler</a></li>
            <li role="presentation" class=""><a href="/admin/events/{{ event.id }}/session/">Sessions</a>
            </li>
            <li role="presentation" class=""><a href="/admin/events/{{ event.id }}/speakers/">Speaker</a>
            </li>
            <li role="presentation" class=""><a href="/admin/events/{{ event.id }}/sponsors/">Sponsors</a>
            </li>
        </ul>
    </div>
    <div class="row">
        <div class="page-title">
            <div class="title_left">
                <h3>{{ event.name }} | Scheduler</h3>
            </div>

        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <div class="x_panel" style="min-height:600px;">
                <div class="row flash-message-holder">
                    <div class="col-md-12" style="text-align: center;">
                        <br>
                        <br>
                        <span class="text-muted message loading-text" style="font-weight: 100; font-size: 30px;">Sessions loading ...</span>
                        <span class="text-danger message error-text"
                              style="font-weight: 100; font-size: 30px; display: none;">Error loading sessions.</span>
                        <br>
                        <br>
                        <br>
                    </div>
                </div>

                <div class="row scheduler-holder" style="display: none;">
                    <div class="col-xs-3 sessions-holder">
                        <h4>Sessions</h4><br>
                        <div class="input-group">
                            <span class="input-group-addon" id="search-addon"><i class="glyphicon glyphicon-search"></i></span>
                            <input type="search" class="form-control" id="sessions-search"
                                   placeholder="Search sessions ..."
                                   aria-describedby="search-addon">
                        </div>
                        <br>
                        <div id="sessions-list" class="sessions-list">

                        </div>
                        <span id="no-sessions-info" class="text-muted no-sessions-info" style="font-size: 24px; font-weight: 100;">
                            No Unscheduled sessions.
                        </span>
                    </div>
                    <div class="col-xs-9">

                        <div class="btn-toolbar" role="toolbar">
                            <div id="date-change-btn-holder" class="btn-group date-change-btn-holder" role="group">

                            </div>
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-default clear-overlaps-button">Clear Overlaps
                                </button>
                                <button type="button" class="btn btn-default" data-toggle="modal"
                                        data-target="#add-microlocation-modal">Add New Microlocation
                                </button>
                            </div>

                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-default" onclick="return export_as_ical();">Export
                                    as iCal
                                </button>
                                <button type="button" class="btn btn-default export-png-button">Export as PNG</button>
                            </div>

                        </div>
                        <div class="timeline" id="timeline" data-event-id="{{ event.id }}"
                             style="margin-top: 10px; margin-left: 10px; width: 100%; overflow-x: hidden;">
                            <table class="timeline-table table" style="width: 100%">
                                <tbody>
                                <tr>
                                    <td class="timeunits x1" width="55">
                                        <div class="timeunit"></div>
                                    </td>
                                    <td class="microlocations x1">
                                        <div id="microlocation-container"
                                             class="microlocation-container clearfix draggable-holder"
                                             style="width: 750px; height: 1311px;">
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <div style="float: right; margin-top: 10px;">
                            All the timings are in UTC
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script id="microlocation-template" type="text/x-template">
        <div class="microlocation">
            <div class="text-center microlocation-header"><span class="badge">0</span></div>
            <div class="microlocation-inner" style="height: 1296px;">

            </div>
        </div>
    </script>


    <script id="date-change-button-template" type="text/x-template">
        <button type="button" class="btn btn-default date-change-btn">May 20</button>
    </script>

    <script id="session-template" type="text/x-template">
        <div class="session" data-toggle="tooltip" data-animation="false" data-placement="top" title="">
            <div class="text">

            </div>
            <i class="edit-btn glyphicon glyphicon-pencil" data-toggle="modal" data-target="#edit-session-modal"></i>
            <i class="remove-btn glyphicon glyphicon-remove"></i>
        </div>
    </script>

    <div class="modal fade" id="edit-session-modal" tabindex="-1" role="dialog" aria-hidden="true"
         data-start-date="{{ event.start_time.strftime('%Y %m %d') }}">
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <form id="edit-session-form">

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span>
                        </button>
                        <h4 class="modal-title">Edit Session</h4>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-sm-12">
                                <div class="col-sm-12 input-group">
                                    <label for="title">Title:</label>
                                    <input type="text" required="required" class="form-control" id="title" name="title"
                                           placeholder="Enter New Title">
                                </div>

                                <div class="col-sm-12 input-group">
                                    <label for="description">New Description:</label>
                                    <textarea id="description" name="description" class="form-control"></textarea>
                                </div>

                                <div class="col-sm-12 input-group">
                                    <label>Abstract:</label>
                                    <input type="text" class="form-control" name="abstract"
                                           placeholder="Enter New Abstract">
                                </div>

                                <div class="col-sm-12 input-group">
                                    <label>Start Time:</label>
                                    <input required="required" name="start_time" class="date-picker form-control"
                                           placeholder="YYYY-MM-DD HH:mm:ss"/>
                                </div>

                                <div class="col-sm-12 input-group">
                                    <label>End Time:</label>
                                    <input required="required" name="end_time" class="date-picker form-control"
                                           placeholder="YYYY-MM-DD HH:mm:ss"/>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="reset" id="close-edit-session" class="btn btn-default" data-dismiss="modal">
                            Close
                        </button>
                        <button type="submit" class="btn btn-primary">Update Session</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <form id="add-microlocation-form" method="post">
        <div class="modal fade" id="add-microlocation-modal" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog modal-sm">
                <div class="modal-content">

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span>
                        </button>
                        <h4 class="modal-title">New Microlocation</h4>
                    </div>
                    <div class="modal-body">
                        <div class="row microlocations">
                            <div class="col-sm-12">
                                <div class="col-sm-12 input-group">
                                    <label>Name:</label>
                                    <input type="text" required="required" class="form-control" name="name"
                                           placeholder="Name">
                                </div>

                                <div class="col-sm-12 input-group">
                                    <label>Latitude:</label>
                                    <input type="number" required="required" class="form-control" name="latitude"
                                           placeholder="Latitude">
                                </div>

                                <div class="col-sm-12 input-group">
                                    <label>Longitude:</label>
                                    <input type="number" required="required" class="form-control" name="longitude"
                                           placeholder="Longitude">
                                </div>

                                <div class="col-sm-12 input-group">
                                    <label>Floor:</label>
                                    <input type="number" required="required" class="form-control" name="floor"
                                           placeholder="Floor">
                                </div>

                                <div class="col-sm-12 input-group">
                                    <label>Room:</label>
                                    <input type="text" required="required" class="form-control" name="Room"
                                           placeholder="Room">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" id="close-add-microlocation" class="btn btn-default" data-dismiss="modal">
                            Close
                        </button>
                        <button type="submit" class="btn btn-primary">Add Microlocation</button>
                    </div>

                </div>
            </div>
        </div>
    </form>


{% endblock %}
{% block tail_js %}
    {{ super() }}
    <script src="{{ url_for('static', filename='admin/lib/interact/dist/interact.min.js') }}"></script>
    <script src="{{ url_for('static', filename='admin/lib/moment/min/moment.min.js') }}"></script>
    <script src="{{ url_for('static', filename='admin/lib/google-material-color/dist/palette.js') }}"></script>
    <script src="{{ url_for('static', filename='admin/lib/lodash/dist/lodash.min.js') }}"></script>
    <script src="{{ url_for('static', filename='admin/lib/bootstrap-daterangepicker/daterangepicker.js') }}"></script>
    <script src="{{ url_for('static', filename='admin/lib/blob/Blob.js') }}"></script>
    <script src="{{ url_for('static', filename='admin/lib/file-saver/FileSaver.min.js') }}"></script>
    <script src="{{ url_for('static', filename='admin/lib/html2canvas/build/html2canvas.min.js') }}"></script>

    <script src="{{ url_for('static', filename='js/jquery/canvas-to-blob.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery/jquery.ellipsis.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/jquery/jquery.codezero.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/admin/event/scheduler.js') }}"></script>

    <script type="text/javascript">
        function export_as_ical(evt) {
            $.getJSON("/api/v1/event/" + {{event.id}} +"/export/ical", function (result) {
                console.log(result["filename"]);
                window.open("/calendar/" + result["filename"]);
            });

            return false;
        }
    </script>

{% endblock %}

