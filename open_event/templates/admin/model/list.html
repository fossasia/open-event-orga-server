{% extends 'admin/base1.html' %}
{% import 'admin/lib.html' as lib with context %}
{% import 'admin/static.html' as admin_static with context%}
{% import 'admin/model/layout.html' as model_layout with context %}
{% import 'admin/actions.html' as actionlib with context %}

{% block head %}
    {{ super() }}
    {{ lib.form_css() }}
{% endblock %}

{% block body %}
    <div class="col-md-2">
    </div>
    <div class="col-md-8">
        <div class="row well">
            <h2>Event List</h2>
            {% block model_menu_bar %}
            <ul class="nav nav-tabs actions-nav">
                <li class="active">
                    <a href="javascript:void(0)">{{ _gettext('List') }} ({{ count }})</a>
                </li>
                {% if admin_view.can_create %}
                <li>
                    <a href="{{ get_url('.create_view', url=return_url) }}" title="{{ _gettext('Create new record') }}">{{ _gettext('Create') }}</a>
                </li>
                {% endif %}

                {% if actions %}
                <li class="dropdown">
                    {{ actionlib.dropdown(actions) }}
                </li>
                {% endif %}

            </ul>
            <br>
            {% endblock %}

            {% block model_list_table %}
            <table class="table table-striped table-bordered table-hover model-list">
                <thead>
                    <tr>
                        {% block list_header scoped %}
                            {% if actions %}
                            <th class="list-checkbox-column" style="text-align: center">
                                <input type="checkbox" name="rowtoggle" class="action-rowtoggle" title="{{ _gettext('Select all records') }}" />
                            </th>
                            {% endif %}
                            {% block list_row_actions_header %}
                            <th class="col-md-1">&nbsp;</th>
                            {% endblock %}
                            {% set column = 0 %}
                            {% for c, name in list_columns %}
                            <th class="column-header">
                                {{ name }}
                                {% if admin_view.column_descriptions.get(c) %}
                                    <a class="glyphicon glyphicon-question-sign"
                                       title="{{ admin_view.column_descriptions[c] }}"
                                       href="javascript:void(0)" data-role="tooltip"
                                    ></a>
                                {% endif %}
                            </th>
                            {% set column = column + 1 %}
                            {% endfor %}
                        {% endblock %}
                    </tr>
                </thead>
                {% for row in data %}
                <tr>
                    {% block list_row scoped %}
                        {% if actions %}
                        <td style="text-align: center">
                            <input type="checkbox" name="rowid" class="action-checkbox" value="{{ get_pk_value(row) }}" title="{{ _gettext('Select record') }}" />
                        </td>
                        {% endif %}
                        {% block list_row_actions_column scoped %}
                        <td>
                            {% block list_row_actions scoped %}
                                    {%- if admin_view.can_edit -%}
                                    <a class="btn btn-info btn-xs table-btn" href="{{ get_url('.edit_view', id=get_pk_value(row), url=return_url) }}" title="{{ _gettext('Edit record') }}">
                                        <span class="glyphicon glyphicon-pencil"></span>
                                    </a>
                                    {%- endif -%}
                                    {%- if admin_view.can_delete -%}
                                     <button class="btn btn-danger btn-xs delete-btn table-btn" title="Delete record">
                                         <span class="glyphicon glyphicon-trash"></span>
                                     </button>
                                    <form method="POST" class="delete-form" action="{{ get_url('.delete_view') }}">
                                        {{ delete_form.id(value=get_pk_value(row)) }}
                                        {{ delete_form.url(value=return_url) }}
                                        {{ delete_form.csrf_token }}
                                    </form>
                                    {%- endif -%}
                            {% endblock %}
                        </td>
                        {% endblock %}
                        {% for c, name in list_columns %}
                            {% if admin_view.is_editable(c) %}
                                {% if form.csrf_token %}
                                <td>{{ form[c](pk=get_pk_value(row), value=get_value(row, c), csrf=form.csrf_token._value()) }}</td>
                                {% else %}
                                <td>{{ form[c](pk=get_pk_value(row), value=get_value(row, c)) }}</td>
                                {% endif %}
                            {% else %}
                            <td>{{ get_value(row, c) }}</td>
                            {% endif %}
                        {% endfor %}
                    {% endblock %}
                </tr>
                {% else %}
                <tr>
                    <td colspan="999">
                        {% block empty_list_message %}
                        <div class="text-center">
                            {{ admin_view.get_empty_list_message() }}
                        </div>
                        {% endblock %}
                    </td>
                </tr>
                {% endfor %}
            </table>
            {{ lib.pager(page, num_pages, pager_url) }}
            {% endblock %}

            {{ actionlib.form(actions, get_url('.action_view')) }}
        </div>
    </div>
    <div class="col-md-2"></div>
{% endblock %}

{% block tail %}
    {{ super() }}
    {{ lib.form_js() }}
    <link rel="stylesheet" type="text/css" href="//cdn.datatables.net/1.10.7/css/jquery.dataTables.css">
    <script type="text/javascript" language="javascript" src="//cdn.datatables.net/1.10.7/js/jquery.dataTables.min.js"></script>

    {{ actionlib.script(_gettext('Please select at least one record.'), actions, actions_confirmation) }}

    <script language="javascript">
        (function($) {
            $('[data-role=tooltip]').tooltip({
                html: true,
                placement: 'bottom'
            });

            $(document).on('click','.delete-btn', function () {
               $(this).siblings(".delete-form").submit();
            });

            $('.model-list').dataTable({
                "scrollX": true,
                "pageLength": 50,
                "order": [[ 2, "asc" ]],
                "autoWidth": false,
                 "columnDefs": [
                    { "width": "10px !important", "targets": 0 },
                    {
                        "render": function ( data, type, row ) {
                            return '<img src="'+data+'" style="width:60px"/>';
                        },
                        "orderable": false,
                        "searchable": false,
                        "targets": 6
                    },
                    {
                        "orderable": false,
                        "searchable": false,
                        "targets": [0,1]
                    },
                    {
                        "render": function ( data, type, row ) {
                            return '<a href="'+data+'">' + data + '</a>';
                        },
                        "targets": 13
                    }
                ]
            });
        })(jQuery);


    </script>
{% endblock %}
